# Утилита `stack`

## Сборка

    $ stack build

Включить почти все предупреждения (`-Wall`) и останавливать сборку на них
(`-Werror`). Полезно и для промышленной разработки, и для обучения.

    $ stack build --pedantic

## Постоянная пересборка

    $ stack build --file-watch

Будет пересобирать при изменении любого исходного файла.

## Тестирование

    $ stack test

это псевдоним для

    $ stack build --test

то есть собрать, и затем запустить тесты.

Можно комбинировать с другими опциями `stack build`, например,

    $ stack test --pedantic --file-watch

## Запуск программы

Команда `stack exec` запускает произвольную команду в окружении проекта
без пересборки.

В том числе её можно применять и для запуска собираемой программы.

Допустим, есть cabal-файл

    name: alphabeta  -- пакет
    ...
    executable gammadelta  -- программа
        ...

Для запуска программы `gammadelta` надо скомандовать

    $ stack exec gammadelta

Если надо передать аргументы

    $ stack                         \
        exec                        \
        --аргументы-для-stack-exec  \
        --                          \
        gammadelta                  \
        --аргументы-для-gammadelta

## (Пере)сборка и запуск

**Способ 1 — сборка перед запуском.**

Команда

    $ stack exec --package=некий-пакет некая-команда

запускает _некую-команду_,
предварительно обеспечивая наличие в окружении _некого-пакета_.

Например, для запуска прогаммы `gammadelta` из текущего проекта
с предварительной его сборкой можно скомандовать

    $ stack exec --package=. gammadelta

или

    $ stack exec --package=alphabeta gammadelta

---

**Способ 2 — запуск после сборки.**

Команда

    $ stack build --exec=некая-команда

соберёт, что скажете, и после успешной сборки запустит _некую-команду_,
например, только что собранную программу.

При комбинации с опцией автоматической пересборки
_некая-команда_ будет запущена после каждой успешной сборки автоматически.
Применять это для тестирования не стоит, лучше написать обычный тест,
который останется в репоизитории, а для отладки удобно.
